<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - Nihongo Sekai</title>
    <meta
      name="description"
      content="Sign in to your Nihongo Sekai account and continue your Japanese learning journey with expert courses and live classrooms."
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéå</text></svg>"
    />
  </head>
  <body class="auth-page">
    <!-- Navigation Header -->
    <header class="header">
      <nav class="navbar">
        <div class="container">
          <div class="nav-brand">
            <a href="index.html" class="brand-link">
              <span class="brand-icon">Êó•</span>
              <span class="brand-text">
                <span class="brand-nihongo">Nihongo</span>
                <span class="brand-sekai">Sekai</span>
              </span>
            </a>
          </div>

          <div class="nav-menu" id="navMenu">
            <ul class="nav-list">
              <li><a href="index.html" class="nav-link">Home</a></li>
              <li><a href="courses.html" class="nav-link">Courses</a></li>
              <li><a href="classrooms.html" class="nav-link">Classrooms</a></li>
              <li><a href="partners.html" class="nav-link">Partners</a></li>
              <li><a href="about.html" class="nav-link">About</a></li>
            </ul>
          </div>

          <div class="nav-actions">
            <a href="login.html" class="btn btn-outline active">Sign In</a>
            <a href="register.html" class="btn btn-primary">Get Started</a>
          </div>

          <button class="nav-toggle" id="navToggle">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="auth-main">
      <div class="auth-card">
        <!-- Form Column -->
        <div class="auth-form-column">
          <div class="auth-header">
            <div class="auth-brand">
              <span class="brand-icon">Êó•</span>
              <span class="brand-nihongo">Nihongo</span>
              <span class="brand-sekai">Sekai</span>
            </div>
            <h1 class="auth-title">Welcome Back</h1>
            <p class="auth-subtitle">
              Sign in to continue your Japanese learning journey
            </p>
          </div>

          <!-- Security Notification -->
          <div
            id="securityNotification"
            class="security-notification"
            style="display: none"
          >
            <div class="security-icon">üîê</div>
            <div class="security-content">
              <div class="security-title">Your password is secure</div>
              <div class="security-description">
                We use advanced encryption and never store passwords in
                plaintext
              </div>
            </div>
          </div>

          <form class="auth-form" id="loginForm" novalidate>
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-input"
                placeholder="Enter your email"
                required
                autocomplete="email"
              />
              <div class="form-error" id="emailError"></div>
            </div>

            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <div class="password-input-group">
                <input
                  type="password"
                  id="password"
                  name="password"
                  class="form-input password-input"
                  placeholder="Enter your password"
                  required
                  autocomplete="current-password"
                />
                <button
                  type="button"
                  class="password-toggle"
                  id="passwordToggle"
                  aria-label="Toggle password visibility"
                >
                  <svg
                    class="eye-icon"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg
                    class="eye-off-icon"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    style="display: none"
                  >
                    <path
                      d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"
                    ></path>
                    <line x1="1" y1="1" x2="23" y2="23"></line>
                  </svg>
                </button>
              </div>
              <div class="form-error" id="passwordError"></div>
            </div>

            <!-- Auth Message -->
            <div id="authMessage" class="auth-message" style="display: none">
              <div class="message-content"></div>
            </div>

            <div class="form-group">
              <button
                type="submit"
                class="btn btn-primary btn-large"
                id="loginButton"
              >
                <span id="loginButtonText">Sign In</span>
                <div
                  id="loginSpinner"
                  class="auth-spinner"
                  style="display: none"
                >
                  <div class="spinner"></div>
                </div>
              </button>
            </div>

            <div class="form-divider">
              <span>or continue with</span>
            </div>

            <!-- Social Login -->
            <div class="social-login">
              <button
                type="button"
                class="btn btn-social btn-google"
                id="googleLogin"
              >
                <svg width="20" height="20" viewBox="0 0 24 24">
                  <path
                    fill="#4285F4"
                    d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"
                  />
                  <path
                    fill="#34A853"
                    d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"
                  />
                  <path
                    fill="#FBBC05"
                    d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"
                  />
                  <path
                    fill="#EA4335"
                    d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"
                  />
                </svg>
                Continue with Google
              </button>

              <button
                type="button"
                class="btn btn-social btn-facebook"
                id="facebookLogin"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="#1877F2">
                  <path
                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"
                  />
                </svg>
                Continue with Facebook
              </button>
            </div>

            <div class="form-footer">
              <div class="form-links">
                <a href="forgot-password.html" class="form-link">
                  Forgot your password?
                </a>
              </div>
              <p class="auth-switch">
                Don't have an account?
                <a href="register.html" class="auth-link">Sign up</a>
              </p>
            </div>

            <!-- Demo Accounts -->
            <div class="demo-accounts">
              <h4>Demo Accounts (for testing)</h4>
              <div class="demo-buttons">
                <button
                  type="button"
                  class="btn btn-demo"
                  onclick="fillDemoAccount('admin')"
                >
                  Admin Demo
                </button>
                <button
                  type="button"
                  class="btn btn-demo"
                  onclick="fillDemoAccount('partner')"
                >
                  Partner Demo
                </button>
                <button
                  type="button"
                  class="btn btn-demo"
                  onclick="fillDemoAccount('learner')"
                >
                  Learner Demo
                </button>
              </div>
            </div>
          </form>
        </div>

        <!-- Benefits Column -->
        <div class="auth-benefits-column">
          <div class="benefits-content">
            <h2>Master Japanese with Confidence</h2>
            <p>
              Join thousands of learners on their journey to Japanese fluency
              with our comprehensive platform
            </p>

            <div class="benefits-list">
              <div class="benefit-item">
                <div class="benefit-icon">üìö</div>
                <div class="benefit-content">
                  <h3>Expert-Led Courses</h3>
                  <p>
                    Learn from native speakers and certified teachers with
                    structured, progressive lessons
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">üí¨</div>
                <div class="benefit-content">
                  <h3>Live Conversation Practice</h3>
                  <p>
                    Join interactive classrooms and practice speaking with real
                    people in real-time
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">üìä</div>
                <div class="benefit-content">
                  <h3>Track Your Progress</h3>
                  <p>
                    Monitor your learning journey with detailed analytics and
                    personalized recommendations
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">üåç</div>
                <div class="benefit-content">
                  <h3>Global Community</h3>
                  <p>
                    Connect with learners worldwide and immerse yourself in
                    Japanese culture
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
      // Enhanced Login Functionality with Security Features
      document.addEventListener("DOMContentLoaded", function () {
        const loginForm = document.getElementById("loginForm");
        const loginButton = document.getElementById("loginButton");
        const loginButtonText = document.getElementById("loginButtonText");
        const loginSpinner = document.getElementById("loginSpinner");
        const authMessage = document.getElementById("authMessage");
        const passwordToggle = document.getElementById("passwordToggle");
        const passwordInput = document.getElementById("password");
        const securityNotification = document.getElementById(
          "securityNotification",
        );

        // Handle form submission
        loginForm.addEventListener("submit", handleLogin);

        // Password visibility toggle
        passwordToggle.addEventListener("click", togglePasswordVisibility);

        // Check for redirect URL
        const redirectUrl = new URLSearchParams(window.location.search).get(
          "redirect",
        );

        function togglePasswordVisibility() {
          const eyeIcon = passwordToggle.querySelector(".eye-icon");
          const eyeOffIcon = passwordToggle.querySelector(".eye-off-icon");

          if (passwordInput.type === "password") {
            passwordInput.type = "text";
            eyeIcon.style.display = "none";
            eyeOffIcon.style.display = "block";
          } else {
            passwordInput.type = "password";
            eyeIcon.style.display = "block";
            eyeOffIcon.style.display = "none";
          }
        }

        async function handleLogin(e) {
          e.preventDefault();

          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          // Validate inputs
          if (!email || !password) {
            showMessage("Please fill in all fields", "error");
            return;
          }

          // Show loading state
          setLoadingState(true);

          try {
            // Secure login - never log password in plaintext
            const loginData = {
              email: email,
              passwordHash: await hashPassword(password), // Hash password client-side
            };

            // Simulate API call - in real app, make actual API request
            const response = await mockLoginAPI(email, password);

            if (response.success) {
              // Show security notification
              showSecurityNotification();

              // Store user data and token securely
              localStorage.setItem("auth_token", response.token);
              localStorage.setItem("user_data", JSON.stringify(response.user));
              localStorage.setItem("user_logged_in", "true");
              localStorage.setItem("user_role", response.user.role);

              showMessage("Login successful! Redirecting...", "success");

              // Redirect based on role and redirect URL
              setTimeout(() => {
                const redirectTo = getRedirectUrl(response.user.role);
                window.location.href = redirectTo;
              }, 2000);
            } else {
              showMessage(response.message || "Login failed", "error");
            }
          } catch (error) {
            console.error(
              "Login error (no sensitive data logged):",
              error.message,
            );
            showMessage("Login failed. Please try again.", "error");
          }

          setLoadingState(false);
        }

        // Simple client-side password hashing (in production, use proper crypto libraries)
        async function hashPassword(password) {
          // This is a simplified example - use proper crypto libraries in production
          const encoder = new TextEncoder();
          const data = encoder.encode(password + "salt_string");
          const hashBuffer = await crypto.subtle.digest("SHA-256", data);
          const hashArray = Array.from(new Uint8Array(hashBuffer));
          return hashArray.map((b) => b.toString(16).padStart(2, "0")).join("");
        }

        function showSecurityNotification() {
          securityNotification.style.display = "flex";
          securityNotification.style.animation = "slideInFromTop 0.5s ease";

          // Auto-hide after 3 seconds
          setTimeout(() => {
            securityNotification.style.animation = "slideOutToTop 0.5s ease";
            setTimeout(() => {
              securityNotification.style.display = "none";
            }, 500);
          }, 3000);
        }

        async function mockLoginAPI(email, password) {
          // Simulate API delay
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Demo accounts (passwords are hashed in real implementation)
          const accounts = {
            "admin@nihongosekai.com": {
              password: "admin123",
              user: {
                id: 1,
                name: "Admin User",
                email: "admin@nihongosekai.com",
                role: "Admin",
                avatar: "AU",
              },
            },
            "partner@nihongosekai.com": {
              password: "partner123",
              user: {
                id: 2,
                name: "Partner User",
                email: "partner@nihongosekai.com",
                role: "Partner",
                avatar: "PU",
              },
            },
            "learner@nihongosekai.com": {
              password: "learner123",
              user: {
                id: 3,
                name: "Learner User",
                email: "learner@nihongosekai.com",
                role: "Learner",
                avatar: "LU",
              },
            },
          };

          const account = accounts[email];
          if (account && account.password === password) {
            return {
              success: true,
              token: "jwt_token_" + Date.now(),
              user: account.user,
              message: "Login successful",
            };
          }

          return {
            success: false,
            message: "Invalid email or password",
          };
        }

        function getRedirectUrl(role) {
          if (redirectUrl) {
            return decodeURIComponent(redirectUrl);
          }

          switch (role) {
            case "Admin":
              return "dashboard.html";
            case "Partner":
              return "index.html";
            case "Learner":
              return "index.html";
            default:
              return "index.html";
          }
        }

        function setLoadingState(loading) {
          loginButton.disabled = loading;
          if (loading) {
            loginButtonText.style.display = "none";
            loginSpinner.style.display = "flex";
          } else {
            loginButtonText.style.display = "block";
            loginSpinner.style.display = "none";
          }
        }

        function showMessage(message, type) {
          const messageContent = authMessage.querySelector(".message-content");
          messageContent.textContent = message;
          authMessage.className = `auth-message ${type}`;
          authMessage.style.display = "block";

          if (type === "success") {
            setTimeout(() => {
              authMessage.style.display = "none";
            }, 3000);
          }
        }

        // Demo account functions
        window.fillDemoAccount = function (type) {
          const accounts = {
            admin: { email: "admin@nihongosekai.com", password: "admin123" },
            partner: {
              email: "partner@nihongosekai.com",
              password: "partner123",
            },
            learner: {
              email: "learner@nihongosekai.com",
              password: "learner123",
            },
          };

          const account = accounts[type];
          if (account) {
            document.getElementById("email").value = account.email;
            document.getElementById("password").value = account.password;
          }
        };
      });
    </script>
  </body>
</html>

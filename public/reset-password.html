<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password - Nihongo Sekai</title>
    <meta
      name="description"
      content="Create a new password for your Nihongo Sekai account."
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üéå</text></svg>"
    />
  </head>
  <body class="auth-page">
    <!-- Navigation Header -->
    <header class="header">
      <nav class="navbar">
        <div class="container">
          <div class="nav-brand">
            <a href="index.html" class="brand-link">
              <span class="brand-icon">Êó•</span>
              <span class="brand-text">
                <span class="brand-nihongo">Nihongo</span>
                <span class="brand-sekai">Sekai</span>
              </span>
            </a>
          </div>

          <div class="nav-menu" id="navMenu">
            <ul class="nav-list">
              <li><a href="index.html" class="nav-link">Home</a></li>
              <li><a href="courses.html" class="nav-link">Courses</a></li>
              <li><a href="classrooms.html" class="nav-link">Classrooms</a></li>
              <li><a href="partners.html" class="nav-link">Partners</a></li>
              <li><a href="about.html" class="nav-link">About</a></li>
            </ul>
          </div>

          <div class="nav-actions">
            <a href="login.html" class="btn btn-outline">Sign In</a>
            <a href="register.html" class="btn btn-primary">Sign Up</a>
          </div>

          <button class="nav-toggle" id="navToggle">
            <span></span>
            <span></span>
            <span></span>
          </button>
        </div>
      </nav>
    </header>

    <!-- Main Content -->
    <main class="auth-main">
      <div class="auth-card">
        <!-- Form Column -->
        <div class="auth-form-column">
          <div class="auth-header">
            <div class="auth-brand">
              <span class="brand-icon">Êó•</span>
              <span class="brand-text">Nihongo Sekai</span>
            </div>
            <h1 class="auth-title">Create New Password</h1>
            <p class="auth-subtitle">
              Choose a strong password to secure your account and continue your
              Japanese learning journey
            </p>
          </div>

          <!-- Error/Success Messages -->
          <div id="authMessage" style="display: none"></div>

          <form class="auth-form" id="resetPasswordForm">
            <div class="form-group">
              <label for="newPassword" class="form-label">New Password</label>
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="newPassword"
                  name="newPassword"
                  class="form-input"
                  placeholder="Enter your new password"
                  required
                  autocomplete="new-password"
                  minlength="8"
                />
                <button
                  type="button"
                  class="password-toggle"
                  onclick="togglePassword('newPassword')"
                  aria-label="Toggle password visibility"
                >
                  <svg
                    id="eyeIcon1"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>

            <div class="form-group">
              <label for="confirmPassword" class="form-label"
                >Confirm New Password</label
              >
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="confirmPassword"
                  name="confirmPassword"
                  class="form-input"
                  placeholder="Confirm your new password"
                  required
                  autocomplete="new-password"
                />
                <button
                  type="button"
                  class="password-toggle"
                  onclick="togglePassword('confirmPassword')"
                  aria-label="Toggle confirm password visibility"
                >
                  <svg
                    id="eyeIcon2"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"
                    ></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
              </div>
            </div>

            <!-- Password Strength Indicator -->
            <div class="password-strength" id="passwordStrength">
              <div class="strength-label">Password Strength:</div>
              <div class="strength-bar">
                <div class="strength-fill" id="strengthFill"></div>
              </div>
              <div class="strength-text" id="strengthText">Enter password</div>
            </div>

            <!-- Password Requirements -->
            <div class="password-requirements">
              <div class="requirement" id="req-length">
                <span class="req-icon">‚óã</span>
                At least 8 characters
              </div>
              <div class="requirement" id="req-uppercase">
                <span class="req-icon">‚óã</span>
                One uppercase letter
              </div>
              <div class="requirement" id="req-lowercase">
                <span class="req-icon">‚óã</span>
                One lowercase letter
              </div>
              <div class="requirement" id="req-number">
                <span class="req-icon">‚óã</span>
                One number
              </div>
            </div>

            <button type="submit" class="auth-button" id="resetButton">
              <span id="resetButtonText">Reset Password</span>
              <div
                id="resetSpinner"
                class="spinner"
                style="display: none"
              ></div>
            </button>
          </form>

          <!-- Auth Links -->
          <div class="auth-links">
            <p>
              Remember your password?
              <a href="login.html" class="auth-link">Sign in here</a>
            </p>
          </div>
        </div>

        <!-- Benefits Column -->
        <div class="auth-benefits-column">
          <div class="benefits-content">
            <div class="benefits-header">
              <h2 class="benefits-title">Almost There!</h2>
              <p class="benefits-subtitle">
                Create a strong password and get back to your Japanese learning
                journey
              </p>
            </div>

            <div class="benefits-list">
              <div class="benefit-item">
                <div class="benefit-icon">üîê</div>
                <div class="benefit-content">
                  <h3>Strong Security</h3>
                  <p>
                    Your new password will keep your account and learning
                    progress safe and secure
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">‚ö°</div>
                <div class="benefit-content">
                  <h3>Quick Access</h3>
                  <p>
                    Get back to your courses and live classrooms in just a few
                    moments
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">üìö</div>
                <div class="benefit-content">
                  <h3>Continue Learning</h3>
                  <p>
                    Your learning progress and achievements are waiting for you
                    right where you left off
                  </p>
                </div>
              </div>

              <div class="benefit-item">
                <div class="benefit-icon">üéØ</div>
                <div class="benefit-content">
                  <h3>Personalized Experience</h3>
                  <p>
                    Your customized learning path and recommendations remain
                    saved and ready
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
      // Reset Password Functionality
      document.addEventListener("DOMContentLoaded", function () {
        const resetPasswordForm = document.getElementById("resetPasswordForm");
        const resetButton = document.getElementById("resetButton");
        const resetButtonText = document.getElementById("resetButtonText");
        const resetSpinner = document.getElementById("resetSpinner");
        const authMessage = document.getElementById("authMessage");

        // Check for reset token
        const resetToken = sessionStorage.getItem("reset_token");
        if (!resetToken) {
          // Redirect back if no reset token in session
          window.location.href = "forgot-password.html";
          return;
        }

        // Password inputs
        const newPasswordInput = document.getElementById("newPassword");
        const confirmPasswordInput = document.getElementById("confirmPassword");

        // Password strength elements
        const strengthFill = document.getElementById("strengthFill");
        const strengthText = document.getElementById("strengthText");

        // Password requirements
        const requirements = {
          length: document.getElementById("req-length"),
          uppercase: document.getElementById("req-uppercase"),
          lowercase: document.getElementById("req-lowercase"),
          number: document.getElementById("req-number"),
        };

        // Handle form submission
        resetPasswordForm.addEventListener("submit", handleResetPassword);

        // Password validation
        newPasswordInput.addEventListener("input", validatePassword);
        confirmPasswordInput.addEventListener("input", validatePasswordMatch);

        function validatePassword() {
          const password = newPasswordInput.value;
          let score = 0;
          const checks = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /\d/.test(password),
          };

          // Update requirement indicators
          Object.keys(checks).forEach((check) => {
            const element = requirements[check];
            const icon = element.querySelector(".req-icon");

            if (checks[check]) {
              element.classList.add("met");
              icon.textContent = "‚úì";
              icon.style.color = "#22c55e";
              score++;
            } else {
              element.classList.remove("met");
              icon.textContent = "‚óã";
              icon.style.color = "#6b7280";
            }
          });

          // Update strength indicator
          updatePasswordStrength(score, password.length);
        }

        function updatePasswordStrength(score, length) {
          const strengthLevels = [
            { text: "Very Weak", color: "#ef4444", width: "20%" },
            { text: "Weak", color: "#f59e0b", width: "40%" },
            { text: "Fair", color: "#eab308", width: "60%" },
            { text: "Good", color: "#22c55e", width: "80%" },
            { text: "Strong", color: "#16a34a", width: "100%" },
          ];

          if (length === 0) {
            strengthText.textContent = "Enter password";
            strengthFill.style.width = "0%";
            strengthFill.style.backgroundColor = "#e5e7eb";
            return;
          }

          const level = Math.min(score, 4);
          const strength = strengthLevels[level];

          strengthText.textContent = strength.text;
          strengthFill.style.width = strength.width;
          strengthFill.style.backgroundColor = strength.color;
        }

        function validatePasswordMatch() {
          const password = newPasswordInput.value;
          const confirmPassword = confirmPasswordInput.value;

          if (confirmPassword && password !== confirmPassword) {
            confirmPasswordInput.setCustomValidity("Passwords do not match");
          } else {
            confirmPasswordInput.setCustomValidity("");
          }
        }

        async function handleResetPassword(e) {
          e.preventDefault();

          const newPassword = newPasswordInput.value;
          const confirmPassword = confirmPasswordInput.value;

          // Validate inputs
          if (!validateForm(newPassword, confirmPassword)) {
            return;
          }

          // Show loading state
          setLoadingState(true);

          try {
            // Simulate API call - in real app, make actual API request
            const response = await mockResetPasswordAPI(
              resetToken,
              newPassword,
            );

            if (response.success) {
              showMessage(
                "Password reset successfully! Redirecting to login...",
                "success",
              );

              // Clear session storage
              sessionStorage.removeItem("reset_email");
              sessionStorage.removeItem("reset_token");

              // Redirect to login page
              setTimeout(() => {
                window.location.href = "login.html";
              }, 2000);
            } else {
              showMessage(
                response.message || "Failed to reset password",
                "error",
              );
            }
          } catch (error) {
            console.error("Reset password error:", error);
            showMessage("An error occurred. Please try again.", "error");
          } finally {
            setLoadingState(false);
          }
        }

        function validateForm(newPassword, confirmPassword) {
          if (newPassword.length < 8) {
            showMessage("Password must be at least 8 characters long", "error");
            return false;
          }

          if (!/[A-Z]/.test(newPassword)) {
            showMessage(
              "Password must contain at least one uppercase letter",
              "error",
            );
            return false;
          }

          if (!/[a-z]/.test(newPassword)) {
            showMessage(
              "Password must contain at least one lowercase letter",
              "error",
            );
            return false;
          }

          if (!/\d/.test(newPassword)) {
            showMessage("Password must contain at least one number", "error");
            return false;
          }

          if (newPassword !== confirmPassword) {
            showMessage("Passwords do not match", "error");
            return false;
          }

          return true;
        }

        async function mockResetPasswordAPI(token, password) {
          // Simulate API delay
          await new Promise((resolve) => setTimeout(resolve, 1500));

          // Mock validation - check if token is valid
          if (token.startsWith("reset_token_")) {
            return {
              success: true,
              message: "Password reset successfully",
            };
          }

          return {
            success: false,
            message: "Invalid or expired reset token",
          };
        }

        function setLoadingState(loading) {
          resetButton.disabled = loading;
          if (loading) {
            resetButton.classList.add("loading");
            resetButtonText.style.display = "none";
            resetSpinner.style.display = "block";
          } else {
            resetButton.classList.remove("loading");
            resetButtonText.style.display = "block";
            resetSpinner.style.display = "none";
          }
        }

        function showMessage(message, type) {
          authMessage.className = `auth-message ${type}`;
          authMessage.innerHTML = `
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              ${getMessageIcon(type)}
            </svg>
            ${message}
          `;
          authMessage.style.display = "flex";

          // Auto-hide success messages
          if (type === "success") {
            setTimeout(() => {
              authMessage.style.display = "none";
            }, 3000);
          }
        }

        function getMessageIcon(type) {
          switch (type) {
            case "success":
              return '<polyline points="20,6 9,17 4,12"></polyline>';
            case "error":
              return '<circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line>';
            case "warning":
              return '<path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line>';
            default:
              return '<circle cx="12" cy="12" r="10"></circle><path d="m9 12 2 2 4-4"></path>';
          }
        }
      });

      // Password toggle functionality
      function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        const iconId = inputId === "newPassword" ? "eyeIcon1" : "eyeIcon2";
        const icon = document.getElementById(iconId);

        if (input.type === "password") {
          input.type = "text";
          icon.innerHTML = `
            <path d="m10.94 6.08a6.93 6.93 0 0 1 1.06-.08c3.87 0 7 2.13 7 4.75 0 2.62-3.13 4.75-7 4.75s-7-2.13-7-4.75c0-1.69 1.63-3.16 4.08-4.08"></path>
            <path d="m2 2 20 20"></path>
            <path d="m6.71 6.71c-.55.79-.71 1.76-.71 2.79 0 2.62 3.13 4.75 7 4.75.75 0 1.47-.11 2.13-.32"></path>
          `;
        } else {
          input.type = "password";
          icon.innerHTML = `
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          `;
        }
      }
    </script>

    <style>
      /* Password Strength Styling */
      .password-strength {
        margin: var(--spacing-md) 0;
        padding: var(--spacing-md);
        background: var(--color-gray-50);
        border-radius: var(--radius-md);
        border: 1px solid var(--color-gray-200);
      }

      .strength-label {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--color-gray-700);
        margin-bottom: var(--spacing-sm);
      }

      .strength-bar {
        height: 6px;
        background: var(--color-gray-200);
        border-radius: 3px;
        overflow: hidden;
        margin-bottom: var(--spacing-sm);
      }

      .strength-fill {
        height: 100%;
        width: 0%;
        transition: all 0.3s ease;
        border-radius: 3px;
      }

      .strength-text {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--color-gray-600);
      }

      /* Password Requirements */
      .password-requirements {
        margin: var(--spacing-lg) 0;
        padding: var(--spacing-md);
        background: var(--color-gray-50);
        border-radius: var(--radius-md);
        border: 1px solid var(--color-gray-200);
      }

      .requirement {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        margin-bottom: var(--spacing-sm);
        font-size: 0.875rem;
        color: var(--color-gray-600);
        transition: color 0.3s ease;
      }

      .requirement:last-child {
        margin-bottom: 0;
      }

      .requirement.met {
        color: var(--color-success);
      }

      .req-icon {
        font-weight: 600;
        width: 16px;
        text-align: center;
      }
    </style>
  </body>
</html>

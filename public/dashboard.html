<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Dashboard - Nihongo Sekai</title>
    <meta
      name="description"
      content="Nihongo Sekai admin dashboard. Manage courses, classrooms, users, and analytics."
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Chart.js for Analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>

    <!-- Favicon -->
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽŒ</text></svg>"
    />
  </head>
  <body class="admin-layout">
    <!-- Admin Sidebar -->
    <aside class="admin-sidebar" id="adminSidebar">
      <div class="sidebar-header">
        <div class="sidebar-brand">
          <span class="brand-icon">æ—¥</span>
          <div>
            <div>Nihongo Sekai</div>
            <div class="sidebar-title">Admin Dashboard</div>
          </div>
        </div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Overview</div>
          <ul class="nav-items">
            <li class="nav-item">
              <a href="dashboard.html" class="nav-link active">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <rect x="3" y="3" width="7" height="9"></rect>
                  <rect x="14" y="3" width="7" height="5"></rect>
                  <rect x="14" y="12" width="7" height="9"></rect>
                  <rect x="3" y="16" width="7" height="5"></rect>
                </svg>
                Analytics
              </a>
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Content Management</div>
          <ul class="nav-items">
            <li class="nav-item">
              <a
                href="#courses"
                class="nav-link"
                onclick="loadSection('courses')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path>
                  <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path>
                </svg>
                Courses
                <span class="nav-badge">12</span>
              </a>
            </li>
            <li class="nav-item">
              <a
                href="#classrooms"
                class="nav-link"
                onclick="loadSection('classrooms')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="m22 21-3-3"></path>
                </svg>
                Classrooms
                <span class="nav-badge">16</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">User Management</div>
          <ul class="nav-items">
            <li class="nav-item">
              <a
                href="#partners"
                class="nav-link"
                onclick="loadSection('partners')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <path d="M22 11l-3-3 3-3"></path>
                  <path d="M19 8h-7"></path>
                </svg>
                Partners
                <span class="nav-badge">10</span>
              </a>
            </li>
            <li class="nav-item">
              <a
                href="#learners"
                class="nav-link"
                onclick="loadSection('learners')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                  <circle cx="9" cy="7" r="4"></circle>
                  <circle cx="19" cy="7" r="2"></circle>
                  <path d="M19 14v7"></path>
                </svg>
                Learners
                <span class="nav-badge">1.2k</span>
              </a>
            </li>
          </ul>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Business</div>
          <ul class="nav-items">
            <li class="nav-item">
              <a
                href="#orders"
                class="nav-link"
                onclick="loadSection('orders')"
              >
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <circle cx="8" cy="21" r="1"></circle>
                  <circle cx="19" cy="21" r="1"></circle>
                  <path
                    d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"
                  ></path>
                </svg>
                Orders
                <span class="nav-badge">89</span>
              </a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>

    <!-- Admin Main Content -->
    <main class="admin-main" id="adminMain">
      <!-- Admin Header -->
      <header class="admin-header">
        <div class="admin-header-left">
          <button class="sidebar-toggle" id="sidebarToggle">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="3" y1="6" x2="21" y2="6"></line>
              <line x1="3" y1="12" x2="21" y2="12"></line>
              <line x1="3" y1="18" x2="21" y2="18"></line>
            </svg>
          </button>
          <h1 class="page-title" id="pageTitle">Analytics Dashboard</h1>
        </div>

        <div class="admin-header-right">
          <div class="admin-user-menu">
            <div class="admin-user-avatar" id="adminUserAvatar">A</div>
            <button
              class="admin-logout-btn"
              onclick="showAdminLogoutConfirmation()"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16,17 21,12 16,7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Log Out
            </button>
          </div>
        </div>
      </header>

      <!-- Admin Content -->
      <div class="admin-content" id="adminContent">
        <!-- Analytics Dashboard (Default View) -->
        <div id="analyticsSection">
          <!-- Stats Cards -->
          <div class="dashboard-grid">
            <div class="stats-card">
              <div class="stats-card-header">
                <div class="stats-card-title">Total Revenue</div>
                <div class="stats-card-icon revenue">ðŸ’°</div>
              </div>
              <div class="stats-card-value" id="totalRevenue">$24,750</div>
              <div class="stats-card-change positive">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                  <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                +12.5% from last month
              </div>
            </div>

            <div class="stats-card">
              <div class="stats-card-header">
                <div class="stats-card-title">Active Learners</div>
                <div class="stats-card-icon users">ðŸ‘¥</div>
              </div>
              <div class="stats-card-value" id="activeUsers">1,247</div>
              <div class="stats-card-change positive">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                  <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                +8.2% from last week
              </div>
            </div>

            <div class="stats-card">
              <div class="stats-card-header">
                <div class="stats-card-title">Total Courses</div>
                <div class="stats-card-icon courses">ðŸ“š</div>
              </div>
              <div class="stats-card-value" id="totalCourses">12</div>
              <div class="stats-card-change positive">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                  <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                +2 new this month
              </div>
            </div>

            <div class="stats-card">
              <div class="stats-card-header">
                <div class="stats-card-title">Live Classrooms</div>
                <div class="stats-card-icon classrooms">ðŸŽ“</div>
              </div>
              <div class="stats-card-value" id="liveClassrooms">16</div>
              <div class="stats-card-change positive">
                <svg
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                  <polyline points="17 6 23 6 23 12"></polyline>
                </svg>
                +4 new sessions
              </div>
            </div>
          </div>

          <!-- Revenue Chart -->
          <div class="chart-card">
            <div class="chart-card-header">
              <div>
                <h3 class="chart-card-title">Revenue by Month</h3>
                <p class="chart-card-subtitle">
                  Track monthly revenue growth and trends
                </p>
              </div>
              <div class="chart-controls">
                <select class="chart-filter" id="revenueFilter">
                  <option value="6months">Last 6 Months</option>
                  <option value="12months">Last 12 Months</option>
                  <option value="24months">Last 24 Months</option>
                </select>
                <button class="export-btn" onclick="exportRevenueData()">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7,10 12,15 17,10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Export CSV
                </button>
              </div>
            </div>
            <div class="chart-container">
              <canvas id="revenueChart" class="chart-canvas"></canvas>
            </div>
          </div>

          <!-- Two Column Layout for Charts -->
          <div
            style="
              display: grid;
              grid-template-columns: 1fr 1fr;
              gap: var(--spacing-xl);
              margin-bottom: var(--spacing-xl);
            "
          >
            <!-- Classroom Hours Chart -->
            <div class="chart-card">
              <div class="chart-card-header">
                <div>
                  <h3 class="chart-card-title">Weekly Classroom Hours</h3>
                  <p class="chart-card-subtitle">
                    Total teaching hours per week
                  </p>
                </div>
                <div class="chart-controls">
                  <select class="chart-filter" id="hoursFilter">
                    <option value="4weeks">Last 4 Weeks</option>
                    <option value="8weeks">Last 8 Weeks</option>
                    <option value="12weeks">Last 12 Weeks</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="hoursChart" class="chart-canvas"></canvas>
              </div>
            </div>

            <!-- Learners Donut Chart -->
            <div class="chart-card">
              <div class="chart-card-header">
                <div>
                  <h3 class="chart-card-title">Active vs New Learners</h3>
                  <p class="chart-card-subtitle">
                    User acquisition and retention
                  </p>
                </div>
                <div class="chart-controls">
                  <select class="chart-filter" id="learnersFilter">
                    <option value="thismonth">This Month</option>
                    <option value="lastmonth">Last Month</option>
                    <option value="quarter">This Quarter</option>
                  </select>
                </div>
              </div>
              <div class="chart-container">
                <canvas id="learnersChart" class="chart-canvas"></canvas>
              </div>
            </div>
          </div>

          <!-- Latest Orders Table -->
          <div class="data-table">
            <div class="data-table-header">
              <h3 class="data-table-title">Latest Orders</h3>
              <div class="data-table-actions">
                <select class="chart-filter" id="ordersFilter">
                  <option value="today">Today</option>
                  <option value="week">This Week</option>
                  <option value="month">This Month</option>
                </select>
                <button class="export-btn" onclick="exportOrdersData()">
                  <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7,10 12,15 17,10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Export
                </button>
              </div>
            </div>
            <div class="table-responsive">
              <table class="table" id="ordersTable">
                <thead>
                  <tr>
                    <th>Order ID</th>
                    <th>Customer</th>
                    <th>Item</th>
                    <th>Amount</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="ordersTableBody">
                  <!-- Orders will be loaded here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <!-- Other Sections (Hidden by Default) -->
        <div id="coursesSection" style="display: none">
          <h2>Courses Management</h2>
          <p>Course management interface will be loaded here.</p>
        </div>

        <div id="classroomsSection" style="display: none">
          <h2>Classrooms Management</h2>
          <p>Classroom management interface will be loaded here.</p>
        </div>

        <div id="partnersSection" style="display: none">
          <h2>Partners Management</h2>
          <p>Partners management interface will be loaded here.</p>
        </div>

        <div id="learnersSection" style="display: none">
          <h2>Learners Management</h2>
          <p>Learners management interface will be loaded here.</p>
        </div>

        <div id="ordersSection" style="display: none">
          <h2>Orders Management</h2>
          <p>Orders management interface will be loaded here.</p>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script>
      // Admin Dashboard Functionality
      document.addEventListener("DOMContentLoaded", function () {
        // Check admin authorization
        if (!checkAdminAuth()) {
          window.location.href = "login.html";
          return;
        }

        // Initialize admin dashboard
        initializeAdminDashboard();
        loadAnalyticsData();
        setupEventListeners();
      });

      function checkAdminAuth() {
        const userData = localStorage.getItem("user_data");
        if (!userData) return false;

        try {
          const user = JSON.parse(userData);
          return user.role === "Admin";
        } catch {
          return false;
        }
      }

      function initializeAdminDashboard() {
        // Setup sidebar toggle
        const sidebarToggle = document.getElementById("sidebarToggle");
        const sidebar = document.getElementById("adminSidebar");
        const mainContent = document.getElementById("adminMain");

        sidebarToggle.addEventListener("click", () => {
          sidebar.classList.toggle("collapsed");
          mainContent.classList.toggle("expanded");
        });

        // Setup user avatar
        const userData = JSON.parse(localStorage.getItem("user_data"));
        if (userData) {
          const userAvatar = document.getElementById("adminUserAvatar");
          userAvatar.textContent = userData.name
            .split(" ")
            .map((name) => name[0])
            .join("")
            .toUpperCase();
        }

        // Initialize enhanced analytics charts
        initializeAnalyticsCharts();
      };

      // Show admin logout confirmation modal
      function showAdminLogoutConfirmation() {
        const modal = document.createElement('div');
        modal.className = 'admin-logout-modal';
        modal.innerHTML = `
          <div class="modal-overlay" onclick="this.parentElement.remove()">
            <div class="modal-content" onclick="event.stopPropagation()">
              <div class="modal-header">
                <h3>Confirm Logout</h3>
                <button class="modal-close" onclick="this.closest('.admin-logout-modal').remove()">Ã—</button>
              </div>
              <div class="modal-body">
                <p>Are you sure you want to log out of the admin dashboard?</p>
              </div>
              <div class="modal-actions">
                <button class="btn btn-outline" onclick="this.closest('.admin-logout-modal').remove()">Cancel</button>
                <button class="btn btn-danger" onclick="confirmAdminLogout()">Confirm</button>
              </div>
            </div>
          </div>
        `;
        document.body.appendChild(modal);
      }

      // Confirm admin logout
      function confirmAdminLogout() {
        const modal = document.querySelector('.admin-logout-modal');
        if (modal) modal.remove();

        // Clear admin session
        localStorage.removeItem("user_logged_in");
        localStorage.removeItem("user_data");
        localStorage.removeItem("auth_token");

        // Redirect to login
        window.location.href = "login.html";
      }

      // Initialize enhanced analytics charts
      function initializeAnalyticsCharts() {
        // Monthly Revenue Chart (Line Chart)
        const revenueCtx = document.getElementById('revenueChart');
        if (revenueCtx) {
          new Chart(revenueCtx, {
            type: 'line',
            data: {
              labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
              datasets: [{
                label: 'Monthly Revenue',
                data: [12000, 15000, 18000, 22000, 25000, 28000, 32000, 35000, 38000, 41000, 43000, 45000],
                borderColor: '#dc2626',
                backgroundColor: 'rgba(220, 38, 38, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true,
                  ticks: {
                    callback: function(value) {
                      return '$' + value.toLocaleString();
                    }
                  }
                }
              }
            }
          });
        }

        // User Sign-ups by Role Chart (Bar Chart)
        const signupsCtx = document.getElementById('signupsChart');
        if (signupsCtx) {
          new Chart(signupsCtx, {
            type: 'bar',
            data: {
              labels: ['Learners', 'Teachers', 'Partners'],
              datasets: [{
                label: 'New Sign-ups',
                data: [450, 120, 35],
                backgroundColor: [
                  '#22c55e',
                  '#3b82f6',
                  '#f59e0b'
                ],
                borderRadius: 6,
                borderSkipped: false
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  display: false
                }
              },
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          });
        }

        // Course vs Classroom Enrollments Chart (Pie Chart)
        const enrollmentsCtx = document.getElementById('enrollmentsChart');
        if (enrollmentsCtx) {
          new Chart(enrollmentsCtx, {
            type: 'doughnut',
            data: {
              labels: ['Course Purchases', 'Classroom Enrollments'],
              datasets: [{
                data: [780, 465],
                backgroundColor: [
                  '#dc2626',
                  '#ec4899'
                ],
                borderWidth: 0,
                cutout: '60%'
              }]
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: {
                  position: 'bottom',
                  labels: {
                    usePointStyle: true,
                    padding: 20
                  }
                }
              }
            }
          });
        }
      }

      // Export functionality
      function exportRevenueData() {
        const csvData = 'Month,Revenue\nJan,12000\nFeb,15000\nMar,18000\nApr,22000\nMay,25000\nJun,28000\nJul,32000\nAug,35000\nSep,38000\nOct,41000\nNov,43000\nDec,45000';
        const blob = new Blob([csvData], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('hidden', '');
        a.setAttribute('href', url);
        a.setAttribute('download', 'revenue-data.csv');
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

        // Setup mobile sidebar
        if (window.innerWidth <= 1024) {
          sidebar.classList.add("collapsed");
          mainContent.classList.add("expanded");
        }
      }

      function setupEventListeners() {
        // Filter change handlers
        document
          .getElementById("revenueFilter")
          .addEventListener("change", updateRevenueChart);
        document
          .getElementById("hoursFilter")
          .addEventListener("change", updateHoursChart);
        document
          .getElementById("learnersFilter")
          .addEventListener("change", updateLearnersChart);
        document
          .getElementById("ordersFilter")
          .addEventListener("change", updateOrdersTable);

        // Mobile responsive
        window.addEventListener("resize", () => {
          if (window.innerWidth <= 1024) {
            document.getElementById("adminSidebar").classList.add("collapsed");
            document.getElementById("adminMain").classList.add("expanded");
          }
        });
      }

      // Section Loading
      function loadSection(sectionName) {
        // Hide all sections
        const sections = [
          "analyticsSection",
          "coursesSection",
          "classroomsSection",
          "partnersSection",
          "learnersSection",
          "ordersSection",
        ];

        sections.forEach((section) => {
          document.getElementById(section).style.display = "none";
        });

        // Show selected section
        document.getElementById(sectionName + "Section").style.display =
          "block";

        // Update page title
        const titles = {
          analytics: "Analytics Dashboard",
          courses: "Courses Management",
          classrooms: "Classrooms Management",
          partners: "Partners Management",
          learners: "Learners Management",
          orders: "Orders Management",
        };

        document.getElementById("pageTitle").textContent = titles[sectionName];

        // Update active nav link
        document.querySelectorAll(".nav-link").forEach((link) => {
          link.classList.remove("active");
        });

        if (sectionName !== "analytics") {
          document
            .querySelector(`[onclick="loadSection('${sectionName}')"]`)
            ?.classList.add("active");
        } else {
          document
            .querySelector('a[href="dashboard.html"]')
            .classList.add("active");
        }
      }

      // Analytics Data Loading
      function loadAnalyticsData() {
        // Load stats
        animateCounter("totalRevenue", 24750, "$", true);
        animateCounter("activeUsers", 1247, "", false);
        animateCounter("totalCourses", 12, "", false);
        animateCounter("liveClassrooms", 16, "", false);

        // Load charts
        createRevenueChart();
        createHoursChart();
        createLearnersChart();
        loadOrdersTable();
      }

      function animateCounter(
        elementId,
        target,
        prefix = "",
        isCurrency = false,
      ) {
        const element = document.getElementById(elementId);
        const duration = 2000;
        const start = 0;
        const startTime = performance.now();

        function updateCounter(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          const current = Math.floor(start + (target - start) * progress);

          if (isCurrency) {
            element.textContent = `$${current.toLocaleString()}`;
          } else {
            element.textContent = `${current.toLocaleString()}`;
          }

          if (progress < 1) {
            requestAnimationFrame(updateCounter);
          }
        }

        requestAnimationFrame(updateCounter);
      }

      // Chart Creation
      let revenueChart, hoursChart, learnersChart;

      function createRevenueChart() {
        const ctx = document.getElementById("revenueChart").getContext("2d");

        const data = {
          labels: ["Jan", "Feb", "Mar", "Apr", "May", "Jun"],
          datasets: [
            {
              label: "Revenue",
              data: [3200, 4150, 3800, 4900, 5200, 4750],
              borderColor: "#dc2626",
              backgroundColor: "rgba(220, 38, 38, 0.1)",
              borderWidth: 3,
              fill: true,
              tension: 0.4,
            },
          ],
        };

        revenueChart = new Chart(ctx, {
          type: "line",
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              x: {
                grid: {
                  display: false,
                },
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return "$" + value.toLocaleString();
                  },
                },
              },
            },
          },
        });
      }

      function createHoursChart() {
        const ctx = document.getElementById("hoursChart").getContext("2d");

        const data = {
          labels: ["Week 1", "Week 2", "Week 3", "Week 4"],
          datasets: [
            {
              label: "Teaching Hours",
              data: [120, 135, 145, 158],
              backgroundColor: ["#dc2626", "#ec4899", "#f59e0b", "#22c55e"],
              borderWidth: 0,
              borderRadius: 8,
            },
          ],
        };

        hoursChart = new Chart(ctx, {
          type: "bar",
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              x: {
                grid: {
                  display: false,
                },
              },
              y: {
                beginAtZero: true,
                ticks: {
                  callback: function (value) {
                    return value + "h";
                  },
                },
              },
            },
          },
        });
      }

      function createLearnersChart() {
        const ctx = document.getElementById("learnersChart").getContext("2d");

        const data = {
          labels: ["Active Learners", "New Learners"],
          datasets: [
            {
              data: [75, 25],
              backgroundColor: ["#dc2626", "#ec4899"],
              borderWidth: 0,
            },
          ],
        };

        learnersChart = new Chart(ctx, {
          type: "doughnut",
          data: data,
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                position: "bottom",
                labels: {
                  padding: 20,
                  usePointStyle: true,
                },
              },
            },
            cutout: "60%",
          },
        });
      }

      // Chart Update Functions
      function updateRevenueChart() {
        const filter = document.getElementById("revenueFilter").value;
        // Update chart data based on filter
        // This would fetch new data from API in a real application
        console.log("Updating revenue chart for:", filter);
      }

      function updateHoursChart() {
        const filter = document.getElementById("hoursFilter").value;
        console.log("Updating hours chart for:", filter);
      }

      function updateLearnersChart() {
        const filter = document.getElementById("learnersFilter").value;
        console.log("Updating learners chart for:", filter);
      }

      // Orders Table
      function loadOrdersTable() {
        const orders = [
          {
            id: "ORD-001",
            customer: "Sarah Johnson",
            item: "Complete Japanese for Beginners",
            amount: 49,
            status: "completed",
            date: "2024-01-15",
          },
          {
            id: "ORD-002",
            customer: "Mike Chen",
            item: "JLPT N5 Preparation",
            amount: 79,
            status: "completed",
            date: "2024-01-14",
          },
          {
            id: "ORD-003",
            customer: "Emily Rodriguez",
            item: "Business Japanese Essentials",
            amount: 129,
            status: "pending",
            date: "2024-01-14",
          },
          {
            id: "ORD-004",
            customer: "David Kim",
            item: "Japanese Grammar Mastery",
            amount: 89,
            status: "completed",
            date: "2024-01-13",
          },
          {
            id: "ORD-005",
            customer: "Alex Turner",
            item: "Morning Conversation Class",
            amount: 25,
            status: "cancelled",
            date: "2024-01-13",
          },
        ];

        const tbody = document.getElementById("ordersTableBody");
        tbody.innerHTML = orders
          .map(
            (order) => `
          <tr>
            <td><strong>${order.id}</strong></td>
            <td>${order.customer}</td>
            <td>${order.item}</td>
            <td>$${order.amount}</td>
            <td><span class="status-badge ${order.status}">${order.status}</span></td>
            <td>${new Date(order.date).toLocaleDateString()}</td>
            <td>
              <div class="quick-actions">
                <button class="action-btn" onclick="viewOrder('${order.id}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                </button>
                <button class="action-btn primary" onclick="editOrder('${order.id}')">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                  </svg>
                </button>
              </div>
            </td>
          </tr>
        `,
          )
          .join("");
      }

      function updateOrdersTable() {
        const filter = document.getElementById("ordersFilter").value;
        console.log("Updating orders table for:", filter);
        // Reload table with filtered data
        loadOrdersTable();
      }

      // Export Functions
      function exportRevenueData() {
        const csvData = generateRevenueCSV();
        downloadCSV(csvData, "revenue_data.csv");
      }

      function exportOrdersData() {
        const csvData = generateOrdersCSV();
        downloadCSV(csvData, "orders_data.csv");
      }

      function generateRevenueCSV() {
        const data = [
          ["Month", "Revenue"],
          ["January", "3200"],
          ["February", "4150"],
          ["March", "3800"],
          ["April", "4900"],
          ["May", "5200"],
          ["June", "4750"],
        ];

        return data.map((row) => row.join(",")).join("\n");
      }

      function generateOrdersCSV() {
        const headers = [
          "Order ID",
          "Customer",
          "Item",
          "Amount",
          "Status",
          "Date",
        ];
        const data = [
          [
            "ORD-001",
            "Sarah Johnson",
            "Complete Japanese for Beginners",
            "49",
            "completed",
            "2024-01-15",
          ],
          [
            "ORD-002",
            "Mike Chen",
            "JLPT N5 Preparation",
            "79",
            "completed",
            "2024-01-14",
          ],
          [
            "ORD-003",
            "Emily Rodriguez",
            "Business Japanese Essentials",
            "129",
            "pending",
            "2024-01-14",
          ],
          [
            "ORD-004",
            "David Kim",
            "Japanese Grammar Mastery",
            "89",
            "completed",
            "2024-01-13",
          ],
          [
            "ORD-005",
            "Alex Turner",
            "Morning Conversation Class",
            "25",
            "cancelled",
            "2024-01-13",
          ],
        ];

        return [headers, ...data].map((row) => row.join(",")).join("\n");
      }

      function downloadCSV(csvData, filename) {
        const blob = new Blob([csvData], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        const url = URL.createObjectURL(blob);

        link.setAttribute("href", url);
        link.setAttribute("download", filename);
        link.style.visibility = "hidden";

        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

        NihongoSekai.showToast(`${filename} exported successfully!`, "success");
      }

      // Action Functions
      function viewOrder(orderId) {
        NihongoSekai.showToast(`Viewing order ${orderId}`, "info");
      }

      function editOrder(orderId) {
        NihongoSekai.showToast(`Editing order ${orderId}`, "info");
      }

      // Global function for section loading
      window.loadSection = loadSection;
    </script>
  </body>
</html>
